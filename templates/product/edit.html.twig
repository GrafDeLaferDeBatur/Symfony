{% extends 'base.html.twig' %}


{% block forsession %}
    {% for message in app.flashes('success') %}
        <div class="alert alert alert-success" role="alert">
            <p class="flash-success">{{ message }}</p>
            <hr>
            <p class="mb-0"><a href="{{ path('showProduct', {'slug' : app.request.attributes.get('slug')}) }}" class="link-underline-light">Look at your product</a></p>
        </div>
    {% endfor %}
{% endblock %}
{% block body %}
{#    {% if is_granted('ROLE_ADMIN') %}#}
{#        hqwqwdqw#}
{#    {% endif %}#}
    {% form_theme form 'bootstrap_5_horizontal_layout.html.twig' %}
    {{ form_start(form) }}

        {{ form_row(form.imageName) }}
        {% if(image) %}
            <img src="{{ asset(image) | imagine_filter('ssdfsdf') }}" alt="sth">
        {% endif %}


        <h3>Phones</h3>
        <ul class="phoneNumbers"
            data-index="{{ form.phoneNumber|length > 0 ? form.phoneNumber|last.vars.name + 1 : 0 }}"
            data-prototype="{{ form_widget(form.phoneNumber.vars.prototype)|e('html_attr') }}"
        >
            {% for telephone in form.phoneNumber %}
                <li>{{ form_row(telephone.phoneNumber) }}</li>
            {% endfor %}
        </ul>
        <button type="button" class="add_item_link btn btn-primary" data-collection-holder-class="phoneNumbers">Add a phone number</button>


    {{ form_end(form) }}
    <script>
        const addTagFormDeleteLink = (item) => {
            const removeFormButton = document.createElement('button');
            removeFormButton.innerText = 'Delete this tag';
            removeFormButton.className = 'btn btn-danger';

            item.append(removeFormButton);

            removeFormButton.addEventListener('click', (e) => {
                e.preventDefault();
                // remove the li for the tag form
                item.remove();
            });
        }
        document
            .querySelectorAll('ul.phoneNumbers li')
            .forEach((phoneNumber) => {
                addTagFormDeleteLink(phoneNumber)
            })
        const addFormToCollection = (e) => {
            const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

            const item = document.createElement('li');

            item.innerHTML = collectionHolder
                .dataset
                .prototype
                .replace(
                    /__name__/g,
                    collectionHolder.dataset.index
                );

            collectionHolder.appendChild(item);

            collectionHolder.dataset.index++;

            addTagFormDeleteLink(item);
        };
        document
            .querySelectorAll('.add_item_link')
            .forEach(btn => {
                btn.addEventListener("click", addFormToCollection)
            });
    </script>

{% endblock %}